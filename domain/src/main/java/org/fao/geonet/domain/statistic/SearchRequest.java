package org.fao.geonet.domain.statistic;

import javax.persistence.Access;
import javax.persistence.AccessType;
import javax.persistence.AttributeOverride;
import javax.persistence.CascadeType;
import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.FetchType;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;
import javax.persistence.Lob;
import javax.persistence.OneToOne;
import javax.persistence.Table;

import org.fao.geonet.domain.Constants;
import org.fao.geonet.domain.ISODate;

/**
 * An entity representing a search request that was made by a user. This is part of the statistics tracing
 * 
 * @author Jesse
 */
@Entity
@Access(AccessType.PROPERTY)
@Table(name = "requests")
public class SearchRequest {
    private int _id;
    private ISODate _requestDate;
    private String _ipAddress;
    private String _luceneQuery;
    private int _hits;
    private String _lang;
    private String _sortBy;
    private String _spatialFilter;
    private String _metadataType;
    private boolean _simple;
    private boolean _autogenerated;
    private String _service;
    private RequestParams _params;

    /**
     * Get the id of the {@link SearchRequest} entity object.
     * <p>
     * This is autogenerated and when a new {@link SearchRequest} is created the {@link SearchRequest} will be assigned a new id.
     * </p>
     * 
     * @return the id of the {@link SearchRequest} entity object.
     */
    @Id
    @GeneratedValue
    public int getId() {
        return _id;
    }

    /**
     * Set the id of the {@link SearchRequest} entity object.
     * <p>
     * This is autogenerated and when a new group is created the group will be assigned a new value.
     * </p>
     * 
     * @param id the id of the Request entity object.
     */
    public void setId(int id) {
        this._id = id;
    }

    /**
     * Get the parameters object associated with this request entity.
     * 
     * @return the parameters object associated with this request entity.
     */
    @OneToOne(cascade = CascadeType.ALL, mappedBy = "request", orphanRemoval = true, fetch = FetchType.LAZY)
    public RequestParams getParams() {
        return _params;
    }

    /**
     * Set the parameters object associated with this request entity.
     * 
     * @param params the parameters object associated with this request entity.
     */
    public void setParams(RequestParams params) {
        this._params = params;
    }

    /**
     * Get the date and time that the request was executed.
     * 
     * @return the date and time that the request was executed.
     */
    @AttributeOverride(name = "dateAndTime", column = @Column(name = "requestdate", length = 30))
    public ISODate getRequestDate() {
        return _requestDate;
    }

    /**
     * Set the date and time that the request was executed.
     * 
     * @param requestDate the date and time that the request was executed.
     */
    public void setRequestDate(ISODate requestDate) {
        this._requestDate = requestDate;
    }

    /**
     * Get the IP address of the requester.
     * 
     * @return the IP address of the requester.
     */
    @Column(name = "ip", length = Constants.IP_ADDRESS_COLUMN_LENGTH)
    public String getIpAddress() {
        return _ipAddress;
    }

    /**
     * Set the IP address of the requester.
     * 
     * @param ipAddress the IP address of the requester.
     */
    public void setIpAddress(String ipAddress) {
        this._ipAddress = ipAddress;
    }

    /**
     * Get the Query data sent by the user. The query should be a lucene query in string form.
     * 
     * @return the Query data sent by the user. The query should be a lucene query in string form.
     */
    @Lob
    @Column(name = "query")
    public String getLuceneQuery() {
        return _luceneQuery;
    }

    /**
     * Set the search query data sent by the user. The query should be a lucene query in string form.
     * 
     * @param luceneQuery the query data sent by the user. The query should be a lucene query in string form.
     */
    public void setLuceneQuery(String luceneQuery) {
        this._luceneQuery = luceneQuery;
    }

    /**
     * Get the number of hits (metadata elements found by query).
     * 
     * @return the number of hits (metadata elements found by query).
     */
    @Column(nullable = false)
    public int getHits() {
        return _hits;
    }

    /**
     * Set the number of hits (metadata elements found by query).
     * 
     * @param hits the number of hits (metadata elements found by query).
     */
    public void setHits(int hits) {
        this._hits = hits;
    }

    /**
     * Get the language the search was made in.
     * 
     * @return the language the search was made in.
     */
    @Column(length = 16)
    public String getLang() {
        return _lang;
    }

    /**
     * The language the search was made in.
     * 
     * @param lang the language the search was made in.
     */
    public void setLang(String lang) {
        this._lang = lang;
    }

    /**
     * Get the sortby parameter used in the request.
     * 
     * @return the sortby parameter used in the request.
     */
    @Column(name = "sortby")
    public String getSortBy() {
        return _sortBy;
    }

    /**
     * Set the sortby parameter used in the request.
     * 
     * @param sortBy the sortby parameter used in the request.
     */
    public void setSortBy(String sortBy) {
        this._sortBy = sortBy;
    }

    /**
     * Get the spatial filter used to further refine the search. The value is in OGC filter spec XML.
     * 
     * @return the spatial filter used to further refine the search. The value is in OGC filter spec XML.
     */
    @Column(name = "spatialfilter")
    @Lob
    public String getSpatialFilter() {
        return _spatialFilter;
    }

    /**
     * Set the spatial filter used to further refine the search. The value is in OGC filter spec XML.
     * 
     * @param spatialFilter the spatial filter used to further refine the search. The value is in OGC filter spec XML.
     */
    public void setSpatialFilter(String spatialFilter) {
        this._spatialFilter = spatialFilter;
    }

    /**
     * Get the type of metadata requested.
     * 
     * @return the type of metadata requested.
     */
    @Lob
    @Column(name = "type")
    public String getMetadataType() {
        return _metadataType;
    }

    /**
     * Set the type of metadata requested.
     * 
     * @param type the type of metadata requested.
     */
    public void setMetadataType(String type) {
        this._metadataType = type;
    }

    /**
     * Get the service used to make the request.
     * 
     * @return the service used to make the request.
     */
    public String getService() {
        return _service;
    }

    /**
     * Set the service used to make the request.
     * @param service the service used to make the request.
     */
    public void setService(String service) {
        this._service = service;
    }

    /**
     * Get true if query is a simple query:
     *
     * The query and spatial filter has only Lucene +any, or +type, 
     * => if queryInfo has a field different from:
     * (any, type, _isTemplate, _locale, _owner, _op*) then its an advanced query
     * 
     * @return true if query is a simple query
     */
    public boolean isSimple() {
        return _simple;
    }

    /**
     * Set true if query is a simple query:
     * 
     * 
     * The query and spatial filter has only Lucene +any, or +type, 
     * => if queryInfo has a field different from:
     * (any, type, _isTemplate, _locale, _owner, _op*) then its an advanced query
     * 
     * @param simple true if query is a simple query
     */
    public void setSimple(boolean simple) {
        this._simple = simple;
    }

    /**
     * Get true if the query was not made by a client but rather by the system itself, for example
     * by a guiservice.
     *
     * @return true if the query was not made by a client but rather by the system itself, for example
     * by a guiservice.
     */
    public boolean isAutogenerated() {
        return _autogenerated;
    }

    /**
     * Set true if the query was not made by a client but rather by the system itself, for example
     * by a guiservice.
     * @param autogenerated true if the query was not made by a client but rather by the system itself, for example
     * by a guiservice.
     */
    public void setAutogenerated(boolean autogenerated) {
        this._autogenerated = autogenerated;
    }

}
